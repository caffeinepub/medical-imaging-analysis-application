{
  "kind": "build_request",
  "title": "Fix missing API Configuration dialog for CT scan analysis",
  "projectName": "MediScan AI",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Ensure the API Configuration modal dialog is visible and accessible in the UI. The Header component must render the 'API Config' button for admin users, and clicking it must open the ApiConfigDialog modal.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "this feature is missing where I input my API end point url and API key to get my analysis report"
        ]
      },
      "acceptanceCriteria": [
        "Admin users see an 'API Config' button in the header after logging in",
        "Clicking the button opens the API Configuration modal dialog",
        "The modal renders with a semi-transparent black backdrop overlay",
        "The dialog box is white, rounded, centered, approximately 500px wide"
      ]
    },
    {
      "id": "REQ-2",
      "text": "The API Configuration dialog must contain: a bold 'API Configuration' title, an 'API Endpoint URL' text input field, an 'API Key' password input field with character masking, a gray outlined 'Cancel' button, and a solid blue 'Save' button. Pre-fill the fields with any existing values loaded from the backend.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Title: 'API Configuration' in bold",
          "Two input fields with labels: 'API Endpoint URL' (text input), 'API Key' (password input with masking)",
          "Buttons at bottom: Cancel (gray outline), Save (solid blue)"
        ]
      },
      "acceptanceCriteria": [
        "Dialog title reads 'API Configuration' in bold",
        "An 'API Endpoint URL' labeled text input is present",
        "An 'API Key' labeled password input is present with characters masked",
        "Existing saved endpoint URL and API key are pre-filled when the dialog opens",
        "Cancel button has a gray outline style and closes the dialog without saving",
        "Save button has a solid blue style and persists the values to the backend",
        "Inline validation shows an error if the endpoint URL is empty or malformed before saving"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Ensure the backend actor exposes a stable API configuration endpoint that accepts and persists an API endpoint URL and API key, and returns them when queried. Verify the external API config getter and setter functions are correctly defined in main.mo and that the migration module handles the combined ExternalApiConfig record shape.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "API Endpoint URL: The full URL where your AI model API is hosted",
          "API Key: Your authentication key from the AI service provider"
        ]
      },
      "acceptanceCriteria": [
        "Backend exposes a query to retrieve the current ExternalApiConfig (endpoint URL + API key)",
        "Backend exposes an update function to save a new ExternalApiConfig",
        "Only admin-role users can set the API configuration",
        "Migration module correctly maps old separate apiEndpoint/apiKey fields into the combined ExternalApiConfig record"
      ]
    }
  ],
  "constraints": [
    "Do not modify files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, or frontend/src/components/ui",
    "All Motoko logic must remain in the single main actor (backend/main.mo)",
    "API key must be stored only in the backend, never in localStorage or frontend state beyond the current session"
  ],
  "nonGoals": [
    "Adding new AI analysis logic or changing how CT scans are processed",
    "Supporting multiple API configurations or per-user API keys",
    "Implementing CORS proxy or any server-side request forwarding",
    "Changing the authentication mechanism (Internet Identity remains the only auth method)"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}